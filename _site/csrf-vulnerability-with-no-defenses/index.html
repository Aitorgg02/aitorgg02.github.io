<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>            CSRF vulnerability with no defenses – PortSwigger Write Up - Aitor      Ciberseguridad y Hacking Ético      </title>
<meta name="description" content="En este post vamos a estar resolviendo el laboratorio de PortSwigger: “CSRF vulnerability with no defenses.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Aitor | Ciberseguridad y Hacking Ético">
<meta property="og:title" content="CSRF vulnerability with no defenses – PortSwigger Write Up">
<meta property="og:url" content="http://localhost:4000/csrf-vulnerability-with-no-defenses/">


  <meta property="og:description" content="En este post vamos a estar resolviendo el laboratorio de PortSwigger: “CSRF vulnerability with no defenses.">







  <meta property="article:published_time" content="2022-09-07T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/csrf-vulnerability-with-no-defenses/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Aitorgg02",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Aitor | Ciberseguridad y Hacking Ético Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Artículos</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categorías</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Etiquetas</a>
            </li><li class="masthead__menu-item">
              <a href="/ctf/" >CTF</a>
            </li><li class="masthead__menu-item">
              <a href="/buscador/" >Buscador</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">CSRF vulnerability with no defenses – PortSwigger Write Up</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="Aitorgg02" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Aitorgg02</h3>
    
    
      <p class="author__bio" itemprop="description">
        CyberSecurity and Web Developer
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/aitor-gonzález-gonzález-44b836189" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/aitorgg02" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="CSRF vulnerability with no defenses – PortSwigger Write Up">
    <meta itemprop="description" content="En este post vamos a estar resolviendo el laboratorio de PortSwigger: “CSRF vulnerability with no defenses.">
    <meta itemprop="datePublished" content="September 07, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">CSRF vulnerability with no defenses – PortSwigger Write Up
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2022-09-07T00:00:00+02:00">September 07, 2022 </time>&emsp;
          
          
        </p>
        <p>En este post vamos a estar resolviendo el laboratorio de PortSwigger: “CSRF vulnerability with no defenses.”</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/1.png" width="1000" />
</p>
<p><br /></p>

<p>En este caso, el laboratorio nos indica que hay un CSRF en la funcionalidad de cambio de email. Para resolver el laboratorio, debemos crear una página HTML que se aproveche del CSRF para cambiar el email de quien visite nuestra web. Por último, se nos proporciona unas credenciales para acceder a una cuenta.</p>

<p>Sabiendo todo esto, iniciamos el laboratorio y nos dirigimos a “My account” para iniciar sesión:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/2.png" width="1000" />
</p>
<p><br /></p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/3.png" width="1000" />
</p>
<p><br /></p>

<p>Una vez hemos iniciado sesión, se nos redirige por así decirlo a nuestro perfil:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/4.png" width="1000" />
</p>
<p><br /></p>

<p>Aquí, como mencionaba el enunciado, encontramos una funcionalidad para cambiar el email de nuestra cuenta, por lo que preparamos el burp suite para interceptar la petición del cambio:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/5.png" width="1000" />
</p>
<p><br /></p>

<p>Con el burp suite preparado, colocamos un email aleatorio y le damos a “Update email”:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/6.png" width="1000" />
</p>
<p><br /></p>

<p>Al momento de darle, burp suite recibe la petición:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/7.png" width="1000" />
</p>
<p><br /></p>

<p>Y como podemos observar, el único parámetro que se envía en el cuerpo de la petición es “email”. No hay ningún parámetro más cuyo valor sea aleatorio e imposible de predecir, por lo que es posible crear una plantilla maliciosa que cree una petición como la que se puede ver arriba, teniendo en cuenta, que las cookies de un sitio son incluidas en cualquier petición que el navegador haga a ese sitio.</p>

<p>Si dejamos que esta petición se envíe, el email cambiará sin problemas:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/8.png" width="1000" />
</p>
<p><br /></p>

<p>Ya sabemos toda la información necesaria y todo funciona como se espera, por lo que desactivamos el proxy y nos dirigimos al servidor del exploit:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/9.png" width="1000" />
</p>
<p><br /></p>

<p>Una vez dentro tenemos los siguientes campos:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/10.png" width="1000" />
</p>
<p><br /></p>

<p>Es aquí donde creamos la plantilla HTML maliciosa que generará la petición que veíamos arriba cuando la víctima visite la página:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/11.png" width="1000" />
</p>
<p><br /></p>

<p>Sí, le damos a ver exploit. nosotros mismos visitaremos la página maliciosa.</p>

<p>Como tenemos la sesión guardada en el navegador con las cookies, al visitarla, la petición se genera correctamente y el email es cambiado, todo a partir de solo visitar la web maliciosa.</p>

<p>Entonces, lo que ha ocurrido es:</p>

<ul>
  <li>La web maliciosa genera una petición especialmente diseñada cuando se visita.</li>
  <li>Si el usuario está logueado en la web vulnerable (este caso), el navegador incluirá automáticamente la cookie de sesión en la petición (suponiendo que la el atributo SameSite de la cookie no está habilitado, que no es este caso)</li>
  <li>La web maliciosa procesará la petición, ya que es imposible diferenciar si la ha hecho la propio víctima o no, por lo que la procesará sin problemas y se cambiará la dirección de email.
Como hemos observado que el exploit funciona perfectamente, simplemente podemos enviarlo a la víctima:</li>
</ul>

<p>Y de esta manera, resolvemos el laboratorio:</p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/12.png" width="1000" />
</p>
<p><br /></p>

<p align="center">
     <img src="/assets/images/portswigger/csrf_vulnerability_with_no_defenses/13.png" width="1000" />
</p>
<p><br /></p>

<p>¡Un saludo y espero que os sirva de apoyo!</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#apprentice" class="page__taxonomy-item" rel="tag">Apprentice</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#burpsuite" class="page__taxonomy-item" rel="tag">Burpsuite</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#csrf" class="page__taxonomy-item" rel="tag">CSRF</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#javascript" class="page__taxonomy-item" rel="tag">JavaScript</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#portswigger" class="page__taxonomy-item" rel="tag">Portswigger</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Fecha:</strong> <time datetime="2022-09-07T00:00:00+02:00">September 07, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/reflected-xss-into-attribute-angle-brackets-html-encoded/" class="pagination--pager" title="Reflected XSS into attribute with angle brackets HTML-encoded – PortSwigger Write Up
">Previous</a>
    
    
      <a href="/reflected-xss-into-javascript-string-with-angle-quote-and-blackslash-escaped/" class="pagination--pager" title="Reflected XSS into a JavaScript string with single quote and backslash escaped – PortSwigger Write Up
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Aitorgg02</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
