---
layout: single
title: Exploiting XXE using external entities to retrieve files – PortSwigger Write Up
excerpt: "En este post vamos a estar resolviendo el laboratorio de PortSwigger: “Exploiting XXE using external entities to retrieve files."
date: 2022-10-15
classes: wide
#header:
#  teaser: /assets/images/portswigger/stored_xss_into_html_context_with_nothing_encoded/portada.png
#  teaser_home_page: true
categories:
  - Portswigger
tags:
  - XML injection
  - Apprentice
---

En este post vamos a estar resolviendo el laboratorio de PortSwigger: "Exploiting XXE using external entities to retrieve files."

## Pasos

<p align="center">
     <img src="/assets/images/portswigger/exploiting_xxe_using_external_entities_to_retrieve_files/1.png" width="1000">
</p><br>

Vemos que en esta situación es una tienda donde podemos ver los detalles de los productos y si nos fijamos podemos ver el stock de cada uno de los productos.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_xxe_using_external_entities_to_retrieve_files/2.png" width="1000">
</p><br>

Este laboratorio tiene una función "Check stock" que analiza la entrada XML y devuelve cualquier valor inesperado en la respuesta.
Para resolver el laboratorio según nos indica la descripción hay que inyectar una entidad externa XML para recuperar el contenido etc/passwd

<p align="center">
     <img src="/assets/images/portswigger/exploiting_xxe_using_external_entities_to_retrieve_files/3.png" width="1000">
</p><br>

Entonces, vamos al laboratorio e interceptamos en segundo plano todos los paquetes en el burpsuite, entonces vamos a un producto y hacemos clic en Check stock y buscamos el paquete en el Http history y lo enviamos al `Repeater`.


<p align="center">
     <img src="/assets/images/portswigger/exploiting_xxe_using_external_entities_to_retrieve_files/4.png" width="1000">
</p><br>

Entonces ahora debemos generar un payload para el ataque, el cual será el siguiente basandonos en la estructura del XML del paquete:

```plaintext
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<stockCheck>
	<productId>
		&xxe;
	</productId>
	<storeId>
		1
	</storeId>
</stockCheck>
```
Y Lo probamos en el paquete para verificar si existe una respuesta válida.


<p align="center">
     <img src="/assets/images/portswigger/exploiting_xxe_using_external_entities_to_retrieve_files/5.png" width="1000">
</p><br>

Ahora, vamos al `home` para verificar que completamos el laboratorio.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_xxe_using_external_entities_to_retrieve_files/6.png" width="1000">
</p><br>

Finalmente completamos el laboratorio.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_xxe_using_external_entities_to_retrieve_files/7.png" width="1000">
</p><br>



¡Un saludo y espero que os sirva de apoyo!
