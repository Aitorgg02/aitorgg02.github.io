---
layout: single
title: Exploiting blind XXE to retrieve data via error messages – PortSwigger Write Up
excerpt: "En este post vamos a estar resolviendo el laboratorio de PortSwigger: “Exploiting blind XXE to retrieve data via error messages."
date: 2022-10-17
classes: wide
#header:
#  teaser: /assets/images/portswigger/stored_xss_into_html_context_with_nothing_encoded/portada.png
#  teaser_home_page: true
categories:
  - Portswigger
tags:
  - XML injection
  - Practitioner
---

En este post vamos a estar resolviendo el laboratorio de PortSwigger: "Exploiting blind XXE to retrieve data via error messages."

## Pasos

Este laboratorio tiene una función "Chack Stock" que analiza la entrada XML pero no muestra el resultado.

Para resolver el laboratorio, use un DTD externo para activar un mensaje de error que muestre el contenido del archivo /etc/passwd.

El laboratorio contiene un enlace a un servidor de exploits en un dominio diferente donde puede alojar su DTD malicioso.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/1.png" width="1000">
</p><br>

Vemos que en esta situación es una tienda donde podemos ver los detalles de los productos y si nos fijamos podemos ver el stock de cada uno de los productos.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/2.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/3.png" width="1000">
</p><br>

Entonces, vamos al laboratorio e interceptamos en segundo plano todos los paquetes en el burpsuite, entonces vamos a un producto y hacemos clic en Check stock y buscamos el paquete en el Http history y lo enviamos al `Repeater`.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/4.png" width="1000">
</p><br>

Entonces ahora lo que haremos será inciar el Burp collaborator y `copiar del clipboard`.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/5.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/6.png" width="1000">
</p><br>

Pegamos en el payload la dirección del clipboard y enviamos la petición, con el `%` ejecutamos dentro de la identidad el ejecutable sin necesidad de llamarla fuera dentro de una `variable`

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/7.png" width="1000">
</p><br>

Ahora le damos a poll now y vemos que se ha ejecutado correctamente. Apagamos el `proxy del burpsuite` y nos vamos al servidor del exploit.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/8.png" width="1000">
</p><br>


<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/9.png" width="1000">
</p><br>

Copiamos al URL que nos da el servidor del exploit para lanzar el ejecutable que tengamos desde ese servidor

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/10.png" width="1000">
</p><br>

Como podemos ver si le damos a `send` y a ver los `logs` del `servidor del exploit` podemos ver que se ha ejecutado correctamente. 

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/11.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/12.png" width="1000">
</p><br>

Finalmente cargamos el payload en el `body del formulario`, le damos a `store` para así guardar el exploit y le damos a `send` para enviarlo. Como vemos finalmente concluimos el laboratorio ya que nos envía el `/etc/passwd`.


<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/13.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/14.png" width="1000">
</p><br>


<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_retrieve_data_via_error_messages/15.png" width="1000">
</p><br>



¡Un saludo y espero que os sirva de apoyo!
