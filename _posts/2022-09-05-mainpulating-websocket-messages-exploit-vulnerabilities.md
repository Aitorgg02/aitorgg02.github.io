---
layout: single
title: Manipulating WebSocket messages to exploit vulnerabilities – PortSwigger Write Up
excerpt: "En este post vamos a estar resolviendo el laboratorio de PortSwigger: “Manipulating WebSocket messages to exploit vulnerabilities."
date: 2022-09-05
classes: wide
#header:
#  teaser: /assets/images/portswigger/stored_xss_into_html_context_with_nothing_encoded/portada.png
#  teaser_home_page: true
categories:
  - Portswigger
tags:
  - Burpsuite
  - JavaScript
  - WebSocket 
  - Apprentice
---

En este post vamos a estar resolviendo el laboratorio de PortSwigger: "Manipulating WebSocket messages to exploit vulnerabilities."

<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/1.png" width="1000">
</p><br>

La aplicación de laboratorio es un sitio web de tienda que ofrece soporte de chat. Después de cargar la página, voy directamente a la función de chat. Así que empiezo a molestar al agente:


<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/2.png" width="1000">
</p><br>

El intercambio de mensajes se ejecuta a través de WebSockets, yo envío mensajes al servidor y el servidor devuelve lo que sea necesario escribir en el chat de mi lado (incluido un espejo de mis propios mensajes):

<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/3.png" width="1000">
</p><br>

Así que pongo el mensaje en el `repeater` y empiezo a jugar:
Si vemos el código html, no hay una sanetización de las etiquetas html, entonces podemos empezar a lanzar un xss mediante etiquetas html en nuestros mensajes.

<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/4.png" width="1000">
</p><br>

Aparentemente, no hay sanetización como hemos mencionado anteriormente de los datos de entrada. Suponiendo que la vista del agente es similar, intento ejecutar un script a través de una `etiqueta <img>`.

<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/5.png" width="1000">
</p><br>

Por supuesto, a medida que se refleja el contenido, también aparece esa ventana emergente, lo que confirma que funcionó al menos de mi parte:

<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/6.png" width="1000">
</p><br>


<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/7.png" width="1000">
</p><br>

Y de esta forma hemos resuelto el laboratorio:

<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/8.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/manipulating_websocket_messages_to_exploit_vulnerabilities/9.png" width="1000">
</p><br>



¡Un saludo y espero que os sirva de apoyo!
