---
layout: single
title: Exploiting blind XXE to exfiltrate data using a malicious external DTD – PortSwigger Write Up
excerpt: "En este post vamos a estar resolviendo el laboratorio de PortSwigger: “Exploiting blind XXE to exfiltrate data using a malicious external DTD."
date: 2022-10-17
classes: wide
#header:
#  teaser: /assets/images/portswigger/stored_xss_into_html_context_with_nothing_encoded/portada.png
#  teaser_home_page: true
categories:
  - Portswigger
tags:
  - XML injection
  - Practitioner
---

En este post vamos a estar resolviendo el laboratorio de PortSwigger: "Exploiting blind XXE to exfiltrate data using a malicious external DTD."

## Pasos

Este laboratorio tiene una función "Check Stock" que analiza la entrada XML pero no muestra el resultado.

Para resolver el laboratorio, active un mensaje de error que contenga el contenido del archivo /etc/passwd.

Deberá hacer referencia a un archivo DTD existente en el servidor y redefinir una entidad a partir de él.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/1.png" width="1000">
</p><br>

Vemos que en esta situación es una tienda donde podemos ver los detalles de los productos y si nos fijamos podemos ver el stock de cada uno de los productos.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/2.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/3.png" width="1000">
</p><br>

Entonces ahora lo que haremos será inciar el Burp collaborator y `copiar del clipboard`.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/4.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/5.png" width="1000">
</p><br>

Elaboramos el payload con la dirección del burp collaborator, enviamos la petición y con el `%` ejecutamos dentro de la identidad el ejecutable sin necesidad de llamarla fuera dentro de una `variable`

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/6.png" width="1000">
</p><br>


Ahora le damos a poll now y vemos que se ha ejecutado correctamente. Apagamos el `proxy del burpsuite` y nos vamos al servidor del exploit.


<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/7.png" width="1000">
</p><br>

Copiamos al URL que nos da el servidor del exploit para lanzar el ejecutable que tengamos desde ese servidor

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/8.png" width="1000">
</p><br>

Cambiando la URL que nos da el servidor en el payload le damos a `send` para ver que tiene conexión el servidor del exploit.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/11.png" width="1000">
</p><br>

Como vemos si nos vamos a `access log` podemos ver que se ha ejecutado correctamente

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/12.png" width="1000">
</p><br>

Ahora vamos a volver al `burp collaborator`, vamos a `copiar el clipboard` y los vamos a pegar en el servidor del exploit para ejecutar el `payload`.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/13.png" width="1000">
</p><br>

Guardamos el exploit.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/14.png" width="1000">
</p><br>

También podemos visualizar el exploit para ver de qué manera se vería y se enviará a la petición. 

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/15.png" width="1000">
</p><br>

Si realiamos un `poll now` nos llega la petición correctamente del servidor y tenemos la respuesta que nos pedían que era el `hostname`

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/16.png" width="1000">
</p><br>

Finalmente copìamos el hostname y lo enviamos y ya estaría resuelto el laboratorio.

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/17.png" width="1000">
</p><br>

<p align="center">
     <img src="/assets/images/portswigger/exploiting_blind_xxe_to_exfiltrate_data_using_a_malicious_external_dtd/18.png" width="1000">
</p><br>

¡Un saludo y espero que os sirva de apoyo!




